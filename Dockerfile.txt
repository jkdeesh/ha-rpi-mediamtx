FROM debian:bookworm-slim

ENV DEBIAN_FRONTEND=noninteractive

# Install ffmpeg and dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        ffmpeg ca-certificates wget && \
    rm -rf /var/lib/apt/lists/*

# Install MediaMTX binary
RUN wget -O /tmp/mediamtx.tar.gz \
      https://github.com/bluenviron/mediamtx/releases/download/v1.15.5/mediamtx_v1.15.5_linux_arm64.tar.gz && \
    tar xzf /tmp/mediamtx.tar.gz -C /usr/local/bin && \
    rm /tmp/mediamtx.tar.gz && \
    chmod +x /usr/local/bin/mediamtx

# Create config dir
RUN mkdir -p /etc/mediamtx

COPY run.sh /run.sh
RUN chmod +x /run.sh

WORKDIR /
ENTRYPOINT ["/run.sh"]
